# Deployment Guide

Complete guide for deploying the Autonomous Operations platform to production.

## üéØ Overview

This guide covers:
1. Local development setup
2. GitHub repository setup
3. GitHub Actions configuration
4. Production deployment
5. Monitoring and maintenance

## üìã Prerequisites

### Required Accounts

- ‚úÖ GitHub account with repository access
- ‚úÖ Anthropic account (for Claude API)
- ‚úÖ Firebase account (optional, for deployment)

### Required Tools

```bash
node --version    # v20.10.0 or higher
npm --version     # v10.2.0 or higher
git --version     # v2.40.0 or higher
gh --version      # v2.40.0 or higher (optional)
```

## üöÄ Deployment Steps

### Step 1: Repository Setup

#### 1.1 Create Repository

```bash
# Option A: Create new repository
gh repo create Autonomous-Operations --public

# Option B: Fork existing repository
gh repo fork ShunsukeHayashi/Autonomous-Operations
```

#### 1.2 Clone Repository

```bash
git clone https://github.com/YOUR_USERNAME/Autonomous-Operations.git
cd Autonomous-Operations
```

#### 1.3 Install Dependencies

```bash
npm install
```

### Step 2: API Keys Configuration

#### 2.1 Get GitHub Token

1. Navigate to https://github.com/settings/tokens
2. Click "Generate new token (classic)"
3. Select scopes:
   - ‚úÖ `repo` (Full control of private repositories)
   - ‚úÖ `workflow` (Update GitHub Action workflows)
   - ‚úÖ `write:packages` (Upload packages)
4. Click "Generate token"
5. **Copy the token** (you won't see it again!)

#### 2.2 Get Anthropic API Key

1. Navigate to https://console.anthropic.com/
2. Go to "API Keys"
3. Click "Create Key"
4. **Copy the key** (starts with `sk-ant-`)

#### 2.3 Configure Local Environment

```bash
# Copy example environment file
cp .env.example .env

# Edit .env
vim .env  # or your preferred editor
```

**Required variables**:
```bash
GITHUB_TOKEN=ghp_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
ANTHROPIC_API_KEY=sk-ant-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
REPOSITORY=YOUR_USERNAME/Autonomous-Operations
DEVICE_IDENTIFIER="MacBook Pro 16-inch"  # or your device name
```

**Optional variables** (for Firebase deployment):
```bash
FIREBASE_STAGING_PROJECT=my-app-staging
FIREBASE_PROD_PROJECT=my-app-prod
STAGING_URL=https://staging.my-app.com
PRODUCTION_URL=https://my-app.com
```

### Step 3: Verify Local Setup

```bash
# TypeScript compilation
npm run typecheck
# ‚úÖ Expected: No errors

# Run tests
npm test
# ‚úÖ Expected: 7 tests passing

# Try dry-run execution
npm run agents:parallel:exec -- --help
# ‚úÖ Expected: Help message displayed
```

### Step 4: GitHub Actions Setup

#### 4.1 Configure Repository Secrets

Navigate to your repository:
```
Settings ‚Üí Secrets and variables ‚Üí Actions ‚Üí New repository secret
```

Add the following secret:
```
Name: ANTHROPIC_API_KEY
Value: sk-ant-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
```

**Note**: `GITHUB_TOKEN` is automatically provided by GitHub Actions, no need to add it manually.

#### 4.2 Enable Workflow Permissions

Navigate to:
```
Settings ‚Üí Actions ‚Üí General ‚Üí Workflow permissions
```

Configure:
- ‚úÖ Select: "Read and write permissions"
- ‚úÖ Check: "Allow GitHub Actions to create and approve pull requests"

Click "Save".

#### 4.3 Verify Workflow File

Ensure `.github/workflows/autonomous-agent.yml` exists:

```bash
ls -la .github/workflows/
# Should show: autonomous-agent.yml
```

### Step 5: Create Labels

GitHub repository needs specific labels for agent execution:

```bash
# Create required labels
gh label create "ü§ñagent-execute" --color "7057ff" --description "Trigger autonomous agent execution"
gh label create "ü§ñagent-generated" --color "0e8a16" --description "Generated by autonomous agents"
gh label create "üö®escalated" --color "d93f0b" --description "Escalated to human review"
gh label create "‚ùåagent-failed" --color "b60205" --description "Agent execution failed"
gh label create "automated" --color "ededed" --description "Automated process"
gh label create "needs-review" --color "fbca04" --description "Requires human review"
```

Or create them manually in:
```
Repository ‚Üí Issues ‚Üí Labels ‚Üí New label
```

### Step 6: Test GitHub Actions

#### 6.1 Create Test Issue

1. Navigate to your repository
2. Click "Issues" ‚Üí "New issue"
3. Select template: "ü§ñ Autonomous Agent Task"
4. Fill in:
   ```markdown
   Title: [TEST] Verify agent execution

   ## üìã Task Description
   Test the autonomous agent execution workflow

   ## üéØ Requirements
   - [ ] Agent should execute successfully
   - [ ] Draft PR should be created
   - [ ] Logs should be uploaded

   ## üìê Technical Specifications
   **Stack/Framework**: TypeScript
   **Dependencies**: None
   **Constraints**: Test only
   ```

5. Click "Create issue"

#### 6.2 Trigger Agent Execution

**Option A: Add Label**
- Add label `ü§ñagent-execute` to the issue

**Option B: Comment Command**
- Comment `/agent` in the issue

**Option C: Manual Trigger**
- Go to "Actions" tab
- Select "Autonomous Agent Execution"
- Click "Run workflow"
- Enter issue number
- Click "Run workflow"

#### 6.3 Monitor Execution

1. Navigate to "Actions" tab
2. Click on the running workflow
3. Monitor logs in real-time
4. Check for:
   - ‚úÖ Dependencies installed
   - ‚úÖ TypeScript compilation
   - ‚úÖ Agent execution
   - ‚úÖ Code changes detected
   - ‚úÖ PR created (draft)

#### 6.4 Verify Results

After workflow completes:

1. **Check Issue Comment**
   - Should have success/failure comment
   - Contains link to PR (if successful)

2. **Check Pull Request**
   - Navigate to "Pull requests"
   - Should see draft PR with auto-generated title
   - Review generated code
   - Check test results in description

3. **Check Logs**
   - Go to failed workflow (if any)
   - Click "Artifacts"
   - Download `agent-execution-logs-*`
   - Review for errors

## üîß Production Configuration

### Firebase Deployment Setup

If using DeploymentAgent for Firebase:

#### 1. Install Firebase CLI

```bash
npm install -g firebase-tools
firebase login
```

#### 2. Initialize Firebase Projects

```bash
# Staging
firebase use --add
# Select staging project
# Alias: staging

# Production
firebase use --add
# Select production project
# Alias: production
```

#### 3. Configure .env

```bash
FIREBASE_STAGING_PROJECT=your-staging-project-id
FIREBASE_PROD_PROJECT=your-prod-project-id
STAGING_URL=https://your-staging-url.web.app
PRODUCTION_URL=https://your-prod-url.web.app
```

#### 4. Add Firebase Token to GitHub Secrets

```bash
# Generate token
firebase login:ci

# Add to GitHub Secrets
# Name: FIREBASE_TOKEN
# Value: <token from above>
```

### Team Configuration

Configure team members for escalation:

```bash
# In .env or GitHub repository variables
TECH_LEAD_GITHUB=techlead-username
CISO_GITHUB=ciso-username
PO_GITHUB=po-username
```

## üìä Monitoring

### View Execution Reports

```bash
# Local reports
cat .ai/parallel-reports/agents-parallel-*.json | jq

# Calculate success rate
jq '.summary.success_rate' .ai/parallel-reports/*.json | \
  awk '{sum+=$1; count++} END {print sum/count "%"}'
```

### GitHub Actions Monitoring

1. **Dashboard**: Actions tab shows all workflow runs
2. **Notifications**: Enable GitHub notifications for workflow failures
3. **Artifacts**: Download logs from completed workflows

### Logs

```bash
# View daily logs
cat .ai/logs/2025-10-08.md

# Search for errors
grep -r "‚ùå" .ai/logs/

# Search for escalations
grep -r "üö®" .ai/logs/
```

## üêõ Troubleshooting

### Common Issues

#### Issue: "GITHUB_TOKEN not found"

**Solution**:
```bash
# Ensure .env exists and has GITHUB_TOKEN
cat .env | grep GITHUB_TOKEN

# Re-create .env from example
cp .env.example .env
vim .env
```

#### Issue: "Workflow not triggering"

**Checks**:
1. ‚úÖ Workflow file exists: `.github/workflows/autonomous-agent.yml`
2. ‚úÖ Workflow permissions enabled
3. ‚úÖ Label `ü§ñagent-execute` exists
4. ‚úÖ Issue has the label applied

**Solution**:
```bash
# Check workflow file
cat .github/workflows/autonomous-agent.yml

# Check labels
gh label list | grep agent

# Manually trigger
gh workflow run "Autonomous Agent Execution" -f issue_number=123
```

#### Issue: "Agent execution failed"

**Debug steps**:
1. Check workflow logs in Actions tab
2. Download artifacts: `agent-execution-logs-*`
3. Review `.ai/logs/` for errors
4. Check if API keys are valid
5. Verify TypeScript compilation: `npm run typecheck`

**Common causes**:
- Invalid API keys
- TypeScript errors
- npm package issues
- GitHub API rate limits

#### Issue: "TypeScript compilation errors"

**Solution**:
```bash
# Clean install
rm -rf node_modules package-lock.json
npm install

# Check for errors
npm run typecheck

# Fix errors (usually import paths)
```

#### Issue: "Tests failing"

**Solution**:
```bash
# Run tests with verbose output
npm test -- --reporter=verbose

# Run single test file
npm test -- tests/coordinator.test.ts

# Update snapshots if needed
npm test -- -u
```

## üîê Security Best Practices

### API Keys

- ‚ùå **Never** commit API keys to git
- ‚úÖ Always use environment variables or GitHub Secrets
- ‚úÖ Rotate keys periodically (every 90 days)
- ‚úÖ Use separate keys for staging/production

### GitHub Tokens

- ‚úÖ Use fine-grained personal access tokens (PAT)
- ‚úÖ Limit scope to minimum required permissions
- ‚úÖ Set expiration date
- ‚úÖ Revoke unused tokens

### Code Review

- ‚úÖ Always review generated code before merging
- ‚úÖ Check for hardcoded secrets
- ‚úÖ Run security scan: `npm audit`
- ‚úÖ Review dependency changes

## üìà Performance Optimization

### Concurrency Tuning

```bash
# Low concurrency (safe, slower)
npm run agents:parallel:exec -- --issues 1,2,3 --concurrency 1

# Medium concurrency (balanced)
npm run agents:parallel:exec -- --issues 1,2,3 --concurrency 3

# High concurrency (fast, more resources)
npm run agents:parallel:exec -- --issues 1,2,3 --concurrency 5
```

**Recommendations**:
- Local development: 1-2
- CI/CD (GitHub Actions): 3-5
- Production server: 5-10 (depends on resources)

### Caching

GitHub Actions caching is configured in the workflow:

```yaml
- uses: actions/setup-node@v4
  with:
    node-version: ${{ env.NODE_VERSION }}
    cache: 'npm'  # ‚Üê Caches node_modules
```

### Resource Limits

```yaml
# GitHub Actions free tier limits:
- Concurrent jobs: 20
- Storage: 500 MB
- Workflow run time: 6 hours
- Job run time: 6 hours
```

## üîÑ Maintenance

### Regular Tasks

**Daily**:
- Monitor workflow execution
- Review failed runs
- Check escalated issues

**Weekly**:
- Review success rate metrics
- Update dependencies: `npm update`
- Clean old logs (>30 days)

**Monthly**:
- Rotate API keys
- Review and optimize concurrency
- Update documentation
- Review agent performance metrics

### Backup

```bash
# Backup configuration
tar -czf backup-$(date +%Y%m%d).tar.gz \
  .env \
  .ai/ \
  .github/ \
  package.json \
  tsconfig.json

# Backup to cloud storage
# aws s3 cp backup-*.tar.gz s3://backups/autonomous-ops/
```

## üìö Additional Resources

- [README.md](README.md) - Project overview
- [CONTRIBUTING.md](CONTRIBUTING.md) - Contribution guidelines
- [docs/AGENT_OPERATIONS_MANUAL.md](docs/AGENT_OPERATIONS_MANUAL.md) - Complete operations manual
- [GitHub Actions Documentation](https://docs.github.com/en/actions)
- [Anthropic API Documentation](https://docs.anthropic.com/)

## üÜò Getting Help

If you encounter issues:

1. **Check documentation**: Start with this guide and README.md
2. **Search issues**: Look for similar problems in GitHub Issues
3. **Create issue**: Use bug report template
4. **Community support**: GitHub Discussions

---

ü§ñ Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>
