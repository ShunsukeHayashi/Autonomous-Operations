# Claude Code Task Tool Integration Guide

## üéØ Ê¶ÇË¶Å

**„Åô„Åπ„Å¶„ÅÆ„Çø„Çπ„ÇØÂÆüË°å„ÅØ Claude Code „ÅÆ Task tool „Çí‰ΩøÁî®„Åô„ÇãÂøÖË¶Å„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ**

„Åì„ÅÆ„Ç¨„Ç§„Éâ„Åß„ÅØ„ÄÅClaude Code Task tool „ÅÆÁµ±ÂêàÊñπÊ≥ï„ÄÅ„Éô„Çπ„Éà„Éó„É©„ÇØ„ÉÜ„Ç£„Çπ„ÄÅ‰ΩøÁî®„Éë„Çø„Éº„É≥„ÇíË™¨Êòé„Åó„Åæ„Åô„ÄÇ

### „Å™„Åú Task Tool „ÅåÂøÖÈ†à„Å™„ÅÆ„ÅãÔºü

1. **‰∏¶ÂàóÂÆüË°å„ÅÆÁÆ°ÁêÜ**: Ë§áÊï∞„ÅÆ„Çø„Çπ„ÇØ„ÇíÂÆâÂÖ®„Å´‰∏¶ÂàóÂÆüË°å
2. **ÈÄ≤Êçó„ÅÆÂèØË¶ñÂåñ**: „Çø„Çπ„ÇØ„ÅÆÁä∂ÊÖã„Çí„É™„Ç¢„É´„Çø„Ç§„É†„ÅßËøΩË∑°
3. **„Ç®„É©„Éº„Éè„É≥„Éâ„É™„É≥„Ç∞**: Â§±Êïó„Åó„Åü„Çø„Çπ„ÇØ„ÅÆËá™Âãï„É™„Éà„É©„Ç§„Å®ÂõûÂæ©
4. **Áõ£Êüª„É≠„Ç∞**: „Åô„Åπ„Å¶„ÅÆ„Çø„Çπ„ÇØÂÆüË°å„ÅÆÂÆåÂÖ®„Å™Ë®òÈå≤
5. **„É™„ÇΩ„Éº„ÇπÁÆ°ÁêÜ**: „É°„É¢„É™„Å®CPU„ÅÆÂäπÁéáÁöÑ„Å™Âà©Áî®

---

## üìö Claude Code Task Tool „Å®„ÅØ

Claude Code „ÅÆ Task tool „ÅØ„ÄÅ**Ëá™ÂæãÁöÑ„Å™„Çµ„Éñ„Çø„Çπ„ÇØ„ÇíÂÆüË°å„Åô„Çã„Åü„ÇÅ„ÅÆÂ∞ÇÁî®„Ç§„É≥„Çø„Éº„Éï„Çß„Éº„Çπ**„Åß„Åô„ÄÇ

### ÁâπÂæ¥

- **ÈùûÂêåÊúüÂÆüË°å**: Èï∑ÊôÇÈñì„Çø„Çπ„ÇØ„Çí„Éê„ÉÉ„ÇØ„Ç∞„É©„Ç¶„É≥„Éâ„ÅßÂÆüË°å
- **Áä∂ÊÖãÁÆ°ÁêÜ**: pending ‚Üí running ‚Üí completed/failed
- **ÁµêÊûú„ÅÆÂèñÂæó**: „Çø„Çπ„ÇØÂÆå‰∫ÜÂæå„Å´ÁµêÊûú„ÇíÂèñÂæó
- **„Çø„Ç§„É†„Ç¢„Ç¶„Éà**: Èï∑ÊôÇÈñìÂÆüË°å„Çø„Çπ„ÇØ„ÅÆËá™Âãï„Çø„Ç§„É†„Ç¢„Ç¶„Éà
- **„É≠„Ç∞Âá∫Âäõ**: Ë©≥Á¥∞„Å™ÂÆüË°å„É≠„Ç∞

---

## üîß Âü∫Êú¨ÁöÑ„Å™‰ΩøÁî®ÊñπÊ≥ï

### 1. „Çø„Çπ„ÇØ„ÅÆ‰ΩúÊàê„Å®ÂÆüË°å

#### „Ç∑„É≥„Éó„É´„Å™‰æã
```typescript
// Task tool „Çí‰ΩøÁî®„Åó„Å¶„Çø„Çπ„ÇØ„ÇíÂÆüË°å
const task = await claude.tasks.create({
  prompt: `
    Task: Fix authentication bug in src/auth/login.ts

    Steps:
    1. Read the file src/auth/login.ts
    2. Identify the bug causing login failure
    3. Fix the bug
    4. Add unit tests
    5. Run tests to verify
  `,
  type: 'code-fix',
  timeout: 300000, // 5 minutes
});

// „Çø„Çπ„ÇØ„ÅÆÁõ£Ë¶ñ
const result = await claude.tasks.wait(task.id);

if (result.status === 'completed') {
  console.log('Task completed successfully');
  console.log(result.output);
} else {
  console.error('Task failed:', result.error);
}
```

### 2. ‰∏¶Âàó„Çø„Çπ„ÇØ„ÅÆÂÆüË°å

```typescript
// Ë§áÊï∞„ÅÆ„Çø„Çπ„ÇØ„Çí‰∏¶ÂàóÂÆüË°å
const tasks = [
  { prompt: 'Fix bug in auth module', files: ['src/auth/login.ts'] },
  { prompt: 'Add OAuth support', files: ['src/auth/oauth.ts'] },
  { prompt: 'Update documentation', files: ['docs/AUTH.md'] },
];

// „Åô„Åπ„Å¶„ÅÆ„Çø„Çπ„ÇØ„Çí‰∏¶Âàó„ÅßÈñãÂßã
const taskIds = await Promise.all(
  tasks.map(task => claude.tasks.create({
    prompt: task.prompt,
    type: 'parallel-work',
  }))
);

// „Åô„Åπ„Å¶„ÅÆ„Çø„Çπ„ÇØ„ÅÆÂÆå‰∫Ü„ÇíÂæÖ„Å§
const results = await Promise.all(
  taskIds.map(id => claude.tasks.wait(id))
);

console.log(`Completed: ${results.filter(r => r.status === 'completed').length}/${results.length}`);
```

---

## üèóÔ∏è TaskToolWrapper „ÅÆÂÆüË£Ö

### Ê®ôÊ∫ñÂåñ„Åï„Çå„Åü„É©„ÉÉ„Éë„Éº„ÇØ„É©„Çπ

```typescript
// agents/coordination/TaskToolWrapper.ts
import { logger } from '../ui/index.js';

export interface TaskConfig {
  id: string;
  type: 'fix' | 'feat' | 'refactor' | 'test' | 'docs';
  prompt: string;
  timeout?: number;
  retries?: number;
  files?: string[];
  metadata?: Record<string, any>;
}

export interface TaskResult {
  taskId: string;
  status: 'completed' | 'failed' | 'timeout';
  output?: string;
  error?: Error;
  duration: number;
  timestamp: Date;
}

export class TaskToolWrapper {
  private activeTasks: Map<string, any> = new Map();

  /**
   * Execute a task using Claude Code Task tool
   * @mandatory All tasks MUST use this method
   */
  async executeTask(config: TaskConfig): Promise<TaskResult> {
    const startTime = Date.now();

    logger.info(`Starting task: ${config.id} (${config.type})`);
    logger.muted(`Prompt: ${config.prompt.substring(0, 100)}...`);

    try {
      // Create Claude Code task
      const task = await this.createClaudeTask(config);
      this.activeTasks.set(config.id, task);

      // Monitor task execution
      const result = await this.monitorTask(task, config);

      // Log execution
      await this.logTaskExecution(config, result);

      const duration = Date.now() - startTime;
      logger.success(`Task completed: ${config.id} (${duration}ms)`);

      return {
        taskId: config.id,
        status: 'completed',
        output: result,
        duration,
        timestamp: new Date(),
      };
    } catch (error) {
      const duration = Date.now() - startTime;
      logger.error(`Task failed: ${config.id}`, error as Error);

      // Retry logic
      if (config.retries && config.retries > 0) {
        logger.warning(`Retrying task: ${config.id} (${config.retries} retries left)`);
        return await this.executeTask({
          ...config,
          retries: config.retries - 1,
        });
      }

      return {
        taskId: config.id,
        status: 'failed',
        error: error as Error,
        duration,
        timestamp: new Date(),
      };
    } finally {
      this.activeTasks.delete(config.id);
    }
  }

  /**
   * Create Claude Code task with proper configuration
   */
  private async createClaudeTask(config: TaskConfig): Promise<any> {
    // Note: This is a placeholder for the actual Claude Code Task API
    // The real implementation will use Claude Code's Task tool

    const taskPrompt = this.buildTaskPrompt(config);

    // Simulate Claude Code Task creation
    // In real implementation, this would call:
    // await claude.tasks.create({ prompt: taskPrompt, ... });

    return {
      id: config.id,
      prompt: taskPrompt,
      timeout: config.timeout || 300000,
      status: 'pending',
    };
  }

  /**
   * Build comprehensive task prompt
   */
  private buildTaskPrompt(config: TaskConfig): string {
    return `
Task ID: ${config.id}
Type: ${config.type}
${config.files ? `Files to modify: ${config.files.join(', ')}` : ''}

Task Description:
${config.prompt}

Requirements:
1. Follow the project's coding standards
2. Add appropriate tests
3. Update documentation if needed
4. Ensure all tests pass
5. Commit with descriptive message

${config.metadata ? `\nMetadata:\n${JSON.stringify(config.metadata, null, 2)}` : ''}
    `.trim();
  }

  /**
   * Monitor task execution with progress updates
   */
  private async monitorTask(task: any, config: TaskConfig): Promise<string> {
    const timeout = config.timeout || 300000;
    const startTime = Date.now();

    return new Promise((resolve, reject) => {
      const checkInterval = setInterval(async () => {
        // Check timeout
        if (Date.now() - startTime > timeout) {
          clearInterval(checkInterval);
          reject(new Error(`Task timeout after ${timeout}ms`));
          return;
        }

        // In real implementation, check task status via Claude Code API
        // const status = await claude.tasks.get(task.id);

        // Simulate task completion (placeholder)
        if (Math.random() > 0.7) { // Simulate completion
          clearInterval(checkInterval);
          resolve('Task completed successfully');
        }
      }, 1000);
    });
  }

  /**
   * Log task execution to GitHub Projects V2
   */
  private async logTaskExecution(config: TaskConfig, result: any): Promise<void> {
    const logEntry = {
      taskId: config.id,
      type: config.type,
      timestamp: new Date().toISOString(),
      duration: Date.now(),
      status: 'completed',
      files: config.files || [],
    };

    // Log to file system
    logger.muted(`Task log: ${JSON.stringify(logEntry)}`);

    // TODO: Log to GitHub Projects V2
    // await projectsAPI.addComment(issueNumber, `Task ${config.id} completed`);
  }

  /**
   * Get all active tasks
   */
  getActiveTasks(): Map<string, any> {
    return this.activeTasks;
  }

  /**
   * Cancel a running task
   */
  async cancelTask(taskId: string): Promise<void> {
    const task = this.activeTasks.get(taskId);
    if (task) {
      // In real implementation: await claude.tasks.cancel(task.id);
      this.activeTasks.delete(taskId);
      logger.warning(`Task cancelled: ${taskId}`);
    }
  }
}

// Singleton instance
export const taskToolWrapper = new TaskToolWrapper();
```

---

## üìã ‰ΩøÁî®„Éë„Çø„Éº„É≥

### „Éë„Çø„Éº„É≥ 1: Âçò‰∏Ä„Çø„Çπ„ÇØ„ÅÆÂÆüË°å

```typescript
import { taskToolWrapper } from './agents/coordination/TaskToolWrapper.js';

async function fixBug(issueNumber: number) {
  const result = await taskToolWrapper.executeTask({
    id: `fix-bug-${issueNumber}`,
    type: 'fix',
    prompt: `Fix the bug described in Issue #${issueNumber}`,
    timeout: 600000, // 10 minutes
    retries: 2,
    files: ['src/auth/login.ts'],
  });

  if (result.status === 'completed') {
    console.log('Bug fixed successfully!');
  } else {
    console.error('Failed to fix bug:', result.error);
  }
}
```

### „Éë„Çø„Éº„É≥ 2: ‰æùÂ≠òÈñ¢‰øÇ„ÅÆ„ÅÇ„Çã„Çø„Çπ„ÇØ

```typescript
async function addFeatureWithTests(featureName: string) {
  // Task 1: Generate feature code
  const codeResult = await taskToolWrapper.executeTask({
    id: `feat-${featureName}-code`,
    type: 'feat',
    prompt: `Implement ${featureName} feature`,
    files: [`src/features/${featureName}.ts`],
  });

  if (codeResult.status !== 'completed') {
    throw new Error('Feature implementation failed');
  }

  // Task 2: Generate tests (depends on Task 1)
  const testResult = await taskToolWrapper.executeTask({
    id: `feat-${featureName}-test`,
    type: 'test',
    prompt: `Write comprehensive tests for ${featureName} feature`,
    files: [`tests/features/${featureName}.test.ts`],
    metadata: {
      dependsOn: codeResult.taskId,
    },
  });

  return { codeResult, testResult };
}
```

### „Éë„Çø„Éº„É≥ 3: ‰∏¶Âàó„Çø„Çπ„ÇØ„ÅÆÂÆüË°å

```typescript
async function refactorModule(moduleName: string) {
  const tasks = [
    {
      id: `refactor-${moduleName}-types`,
      type: 'refactor' as const,
      prompt: `Refactor types for ${moduleName}`,
      files: [`src/${moduleName}/types.ts`],
    },
    {
      id: `refactor-${moduleName}-utils`,
      type: 'refactor' as const,
      prompt: `Refactor utilities for ${moduleName}`,
      files: [`src/${moduleName}/utils.ts`],
    },
    {
      id: `refactor-${moduleName}-tests`,
      type: 'test' as const,
      prompt: `Update tests for ${moduleName}`,
      files: [`tests/${moduleName}/*.test.ts`],
    },
  ];

  // Execute all tasks in parallel
  const results = await Promise.all(
    tasks.map(task => taskToolWrapper.executeTask(task))
  );

  const allSuccess = results.every(r => r.status === 'completed');
  return { success: allSuccess, results };
}
```

---

## üéØ „Éô„Çπ„Éà„Éó„É©„ÇØ„ÉÜ„Ç£„Çπ

### 1. ÊòéÁ¢∫„Å™„Çø„Çπ„ÇØ„Éó„É≠„É≥„Éó„Éà

**ËâØ„ÅÑ‰æã:**
```typescript
prompt: `
  Fix authentication bug in src/auth/login.ts

  Problem: Users cannot login with correct credentials
  Root cause: Password hashing comparison is case-sensitive

  Steps:
  1. Read src/auth/login.ts
  2. Fix password comparison logic (line 42)
  3. Add test case for case-insensitive password
  4. Verify all auth tests pass
`
```

**ÊÇ™„ÅÑ‰æã:**
```typescript
prompt: 'Fix login bug' // Too vague
```

### 2. ÈÅ©Âàá„Å™„Çø„Ç§„É†„Ç¢„Ç¶„ÉàË®≠ÂÆö

```typescript
const timeouts = {
  fix: 300000,      // 5 min - Bug fixes
  feat: 600000,     // 10 min - New features
  refactor: 900000, // 15 min - Refactoring
  test: 180000,     // 3 min - Test writing
  docs: 120000,     // 2 min - Documentation
};

await taskToolWrapper.executeTask({
  id: 'task-001',
  type: 'feat',
  prompt: '...',
  timeout: timeouts.feat,
});
```

### 3. „Ç®„É©„Éº„Éè„É≥„Éâ„É™„É≥„Ç∞„Å®„É™„Éà„É©„Ç§

```typescript
async function robustTaskExecution(config: TaskConfig) {
  try {
    const result = await taskToolWrapper.executeTask({
      ...config,
      retries: 3, // Retry up to 3 times
    });

    if (result.status === 'failed') {
      // Notify guardian
      await notifyGuardian({
        taskId: config.id,
        error: result.error,
        action: 'manual_intervention_required',
      });
    }

    return result;
  } catch (error) {
    logger.error('Critical task failure', error as Error);
    throw error;
  }
}
```

### 4. ÈÄ≤Êçó„ÅÆÁõ£Ë¶ñ„Å®„É≠„Ç∞

```typescript
class TaskMonitor {
  async executeWithMonitoring(config: TaskConfig) {
    const startTime = Date.now();

    // Log start
    logger.info(`[${config.id}] Starting task`);

    try {
      const result = await taskToolWrapper.executeTask(config);

      // Log completion
      const duration = Date.now() - startTime;
      logger.success(`[${config.id}] Completed in ${duration}ms`);

      // Update GitHub Projects
      await this.updateProjectStatus(config.id, 'completed');

      return result;
    } catch (error) {
      logger.error(`[${config.id}] Failed`, error as Error);
      await this.updateProjectStatus(config.id, 'failed');
      throw error;
    }
  }

  private async updateProjectStatus(taskId: string, status: string) {
    // Update GitHub Projects V2
    // await projectsAPI.updateItem(taskId, { status });
  }
}
```

---

## üîç „Éá„Éê„ÉÉ„Ç∞„Å®„Éà„É©„Éñ„É´„Ç∑„É•„Éº„ÉÜ„Ç£„É≥„Ç∞

### „Çø„Çπ„ÇØ„Åå„Çø„Ç§„É†„Ç¢„Ç¶„Éà„Åô„ÇãÂ†¥Âêà

```typescript
// „Çø„Ç§„É†„Ç¢„Ç¶„Éà„ÇíÂª∂Èï∑
await taskToolWrapper.executeTask({
  id: 'slow-task',
  type: 'refactor',
  prompt: 'Large refactoring task',
  timeout: 1800000, // 30 minutes
});

// „Åæ„Åü„ÅØ„ÄÅ„Çø„Çπ„ÇØ„ÇíÂàÜÂâ≤
const subtasks = splitLargeTask(largeTask);
for (const subtask of subtasks) {
  await taskToolWrapper.executeTask(subtask);
}
```

### „Çø„Çπ„ÇØ„ÅåÂ§±Êïó„ÅóÁ∂ö„Åë„ÇãÂ†¥Âêà

```typescript
// „Éá„Éê„ÉÉ„Ç∞„É¢„Éº„Éâ„ÅßÂÆüË°å
const result = await taskToolWrapper.executeTask({
  id: 'debug-task',
  type: 'fix',
  prompt: 'Fix with detailed logging',
  metadata: {
    debug: true,
    logLevel: 'verbose',
  },
});

// „É≠„Ç∞„ÇíÁ¢∫Ë™ç
console.log('Task logs:', result.output);
```

### ‰∏¶Âàó„Çø„Çπ„ÇØ„ÅÆ‰æùÂ≠òÈñ¢‰øÇ„Ç®„É©„Éº

```typescript
// DAG (Directed Acyclic Graph) „Çí‰ΩøÁî®
import { TaskDAG } from './agents/coordination/TaskDAG.js';

const dag = new TaskDAG();
dag.addTask('task-1', { type: 'feat', prompt: '...' });
dag.addTask('task-2', { type: 'test', prompt: '...', dependsOn: ['task-1'] });
dag.addTask('task-3', { type: 'docs', prompt: '...', dependsOn: ['task-1'] });

// ‰æùÂ≠òÈñ¢‰øÇ„ÇíËß£Ê±∫„Åó„Å¶È†ÜÊ¨°ÂÆüË°å
const results = await dag.execute(taskToolWrapper);
```

---

## üìä Áõ£Ë¶ñ„Å®„É°„Éà„É™„ÇØ„Çπ

### „Çø„Çπ„ÇØÂÆüË°å„ÅÆÁµ±Ë®à

```typescript
class TaskMetrics {
  private metrics = {
    total: 0,
    completed: 0,
    failed: 0,
    avgDuration: 0,
  };

  recordTask(result: TaskResult) {
    this.metrics.total++;

    if (result.status === 'completed') {
      this.metrics.completed++;
    } else {
      this.metrics.failed++;
    }

    // Update average duration
    this.metrics.avgDuration =
      (this.metrics.avgDuration * (this.metrics.total - 1) + result.duration) /
      this.metrics.total;
  }

  getStats() {
    return {
      ...this.metrics,
      successRate: (this.metrics.completed / this.metrics.total) * 100,
    };
  }
}

// Usage
const metrics = new TaskMetrics();
const result = await taskToolWrapper.executeTask(config);
metrics.recordTask(result);

console.log('Task Statistics:', metrics.getStats());
```

---

## üîó Áµ±Âêà‰æã

### Coordinator Agent „Å®„ÅÆÁµ±Âêà

```typescript
// agents/coordinator.ts
import { taskToolWrapper } from './coordination/TaskToolWrapper.js';

export class CoordinatorAgent {
  async decomposeAndExecute(issue: Issue) {
    // Issue „ÇíÂàÜËß£
    const tasks = await this.decomposeIssue(issue);

    // „Åô„Åπ„Å¶„ÅÆ„Çø„Çπ„ÇØ„Çí Task tool „ÅßÂÆüË°å
    const results = await Promise.all(
      tasks.map(task => taskToolWrapper.executeTask({
        id: task.id,
        type: task.type,
        prompt: task.description,
        files: task.files,
      }))
    );

    return results;
  }
}
```

---

## üìö Èñ¢ÈÄ£„Éâ„Ç≠„É•„É°„É≥„Éà

- [Parallel Work Architecture](./PARALLEL_WORK_ARCHITECTURE.md)
- [Worker Coordination Protocol](./WORKER_COORDINATION_PROTOCOL.md)
- [Claude Code Documentation](https://docs.claude.com/claude-code)

---

## ‚ö†Ô∏è ÈáçË¶Å„Å™Ê≥®ÊÑè‰∫ãÈ†Ö

1. **ÂøÖ„Åö Task tool „Çí‰ΩøÁî®**: Áõ¥Êé•„Ç≥„Éº„ÉâÂÆüË°å„Åß„ÅØ„Å™„Åè„ÄÅÂøÖ„Åö TaskToolWrapper „ÇíÁµåÁî±
2. **ÈÅ©Âàá„Å™„Çø„Ç§„É†„Ç¢„Ç¶„Éà**: „Çø„Çπ„ÇØ„ÅÆË§áÈõë„Åï„Å´Âøú„Åò„Åü„Çø„Ç§„É†„Ç¢„Ç¶„Éà„ÇíË®≠ÂÆö
3. **„Ç®„É©„Éº„Éè„É≥„Éâ„É™„É≥„Ç∞**: „Åô„Åπ„Å¶„ÅÆ„Çø„Çπ„ÇØ„ÅßÈÅ©Âàá„Å™„Ç®„É©„Éº„Éè„É≥„Éâ„É™„É≥„Ç∞
4. **„É≠„Ç∞„ÅÆË®òÈå≤**: „Éá„Éê„ÉÉ„Ç∞„Å®„Éà„É¨„Éº„Ç∑„É≥„Ç∞„ÅÆ„Åü„ÇÅ„Å´Ë©≥Á¥∞„Å™„É≠„Ç∞„ÇíË®òÈå≤
5. **Guardian „Å∏„ÅÆÈÄöÁü•**: ÈáçË¶Å„Å™„Ç®„É©„Éº„ÅØÂøÖ„Åö Guardian „Å´ÈÄöÁü•
